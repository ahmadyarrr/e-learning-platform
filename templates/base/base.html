<!DOCTYPE html>
{% load static %}
{% load allauth account %}
<html>
  <head>
    <title>
      Educa|{% block title %}

      {% endblock %}
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'css/course/base.css' %}" />
    <link rel="stylesheet" href="{% static 'boot/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'boot/css/bootstrap.css' %}" />
    <link rel="stylesheet" href="{% static 'boot/css/bootstrap.grid.css' %}" />
    <link rel="stylesheet" href="{% static 'css/course/header.css' %}" />

    {% block head %}

    {% endblock %}
  </head>
  <body>
    {% include './header.html' %}
    <dialog id="whole-loader" style="all: unset; margin-top: 10%;margin-left: 45%;" >
      <div id="loader"></div>
      <p>Loading...</p>
    </dialog>

    <div id="content" style="display: none;">
      {% block body %}

      {% endblock %}
    </div>
    {% include './footer.html' %}
    {% block include_js %}
      <script type="application/json" id="search-url">
        {{request.get_host}}{%url 'course:search' %}
    </script>
    {% endblock %}
    <script>
            window.addEventListener("DOMContentLoaded",(event) => {
              const searchInput = document.getElementById("search-input")
              const resultListElement = document.getElementById("search-result")
              var timeout;
              searchInput.addEventListener("input",function(event){
                const query =  searchInput.value;
                clearTimeout(timeout);
                timeout = setTimeout(()=>{
                  // fething
                  const url = "http://" + document.getElementById("search-url").innerText.trim()+"?query="+query;
                  fetch(url).then(response => response.json()).then(result =>{
                    const foundCourses = result.result
                    if (foundCourses.length> 0 ){
                      // if there were found any courses
                      // reseting the ul
                      resultListElement.innerHTML = ``
                      resultListElement.style.display = "block"

                      // adding courses titles as li elements to ul
                      foundCourses.forEach(course =>{
                        const li = document.createElement("li")
                        li.style.display = "block"
                        li.innerText = course[1]
                        resultListElement.appendChild(li)
                        // making it a link
                        li.addEventListener("click",function(e){
                          console.log('this url was made', window.location.protocol+ "//"+window.location.host+`/course/${course[0]}/detail` )
                          window.location.href = window.location.protocol+ "//"+window.location.host+`/course/${course[0]}/detail` 
                        })
                      })
                  }
                  else{
                        const li = document.createElement("li")
                        // showing the results ul
                        resultListElement.style.display = "block"
                        li.innerText = "No results..."
                        li.style.display = "block"
                        resultListElement.appendChild(li)

                      }
                  })
                },1000)
              })
              document.body.addEventListener("click",function(e){
                searchInput.value = searchInput.ariaPlaceholder
                resultListElement.style.display = "none"
              })
              // loader

              {%block domeready%}

              {%endblock%}

            })
            document.getElementById("whole-loader").showModal()
            window.addEventListener("load",(event)=>{
              setTimeout(function(e){
                document.getElementById("whole-loader").remove()
                document.getElementById("content").style.display = "block"
              },200)
              
            })
    </script>
  </body>
</html>
